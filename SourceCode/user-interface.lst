Sections:
00: "seg8000" (8000-8155)
01: "segfffc" (FFFC-0)


Source: "user-interface.asm"
                        	     1: ;   File: user-interface.asm
                        	     2: ;   Author: Matt Rude <matt@mattrude.com>
                        	     3: ;   URL: https://github.com/mattrude/windemere-basic
                        	     4: ;   Date: 2022-01-22
                        	     5: ;   Version: 0.1.0a
                        	     6: ;
                        	     7: ;------------------------------------------------------------------------------
                        	     8: ;   Program Summary
                        	     9: ;
                        	    10: ;
                        	    11: ;   The below code is written for a W65C02 connected to a W65C22 (VIA)
                        	    12: ;
                        	    13: ; -----------------------------------------------------------------------------
                        	    14: ;   Compiling from source
                        	    15: ;
                        	    16: ;
                        	    17: ;   This source file expects the use of the vasm compiler found at:
                        	    18: ;       http://sun.hasenbraten.de/vasm/
                        	    19: ;
                        	    20: ;   To compile this code, run a command similer to:
                        	    21: ;       vasm6502_oldstyle -c02 -dotdir -Fbin main.asm -o main.bin
                        	    22: ;
                        	    23: ;       ..\..\..\Tools\vasm6502\vasm6502_oldstyle.exe -c02 -dotdir
                        	    24: ;       -Fbin user-interface_short.asm -o user-interface_short.bin
                        	    25: ;
                        	    26: ; -----------------------------------------------------------------------------
                        	    27: ;   Memory
                        	    28: ;
                        	    29: ;                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        	    30: ;                 ‚îÇ    WD65C02 Memory Map     ‚îÇ
                        	    31: ;                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                        	    32: ;                 ‚îÇ $0000 ‚îÇ                   ‚îÇ
                        	    33: ;                 ‚îÇ       ‚îÇ  Zero Page (RAM)  ‚îÇ
                        	    34: ;                 ‚îÇ $00ff ‚îÇ                   ‚îÇ
                        	    35: ;                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                        	    36: ;                 ‚îÇ $0100 ‚îÇ///////////////////‚îÇ
                        	    37: ;                 ‚îÇ       ‚îÇ////// Stack //////‚îÇ
                        	    38: ;                 ‚îÇ $01ff ‚îÇ///////////////////‚îÇ
                        	    39: ;                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                        	    40: ;                 ‚îÇ $0200 ‚îÇ                   ‚îÇ
                        	    41: ;                 ‚îÇ       ‚îÇ        RAM        ‚îÇ
                        	    42: ;                 ‚îÇ $5fff ‚îÇ                   ‚îÇ
                        	    43: ;                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                        	    44: ;                 ‚îÇ $6000 ‚îÇ                   ‚îÇ
                        	    45: ;                 ‚îÇ       ‚îÇ    W65C22S VIA    ‚îÇ
                        	    46: ;                 ‚îÇ $600f ‚îÇ                   ‚îÇ
                        	    47: ;                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                        	    48: ;                 ‚îÇ $6010 ‚îÇ                   ‚îÇ
                        	    49: ;                 ‚îÇ       ‚îÇ    (Not Used)     ‚îÇ
                        	    50: ;                 ‚îÇ $7fff ‚îÇ                   ‚îÇ
                        	    51: ;                 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                        	    52: ;                 ‚îÇ $8000 ‚îÇ                   ‚îÇ
                        	    53: ;                 ‚îÇ       ‚îÇ        ROM        ‚îÇ
                        	    54: ;                 ‚îÇ $ffff ‚îÇ                   ‚îÇ
                        	    55: ;                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        	    56: ;
                        	    57: ;
                        	    58: ;
                        	    59: ;     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î
                        	    60: ;     ‚îÇ                 Zero Page RAM Locations                ‚îÇ
                        	    61: ;     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î
                        	    62: ;     ‚îÇ 0000: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    63: ;     ‚îÇ 0010: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    64: ;     ‚îÇ 0020: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    65: ;     ‚îÇ 0030: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    66: ;     ‚îÇ 0040: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    67: ;     ‚îÇ 0050: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    68: ;     ‚îÇ 0060: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    69: ;     ‚îÇ 0070: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    70: ;     ‚îÇ 0080: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    71: ;     ‚îÇ 0090: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    72: ;     ‚îÇ 00a0: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    73: ;     ‚îÇ 00b0: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    74: ;     ‚îÇ 00c0: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    75: ;     ‚îÇ 00d0: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    76: ;     ‚îÇ 00e0: -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- -- ‚îÇ
                        	    77: ;     ‚îÇ 00f0: 00 00 00 00 00 00 00 00  -- -- -- -- -- -- -- -- ‚îÇ
                        	    78: ;     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î
                        	    79: ;
                        	    80: ; -----------------------------------------------------------------------------
                        	    81: ;   License
                        	    82: ;
                        	    83: ; MIT No Attribution License
                        	    84: ;
                        	    85: ; Copyright (c) 2022 Matt Rude
                        	    86: ; 
                        	    87: ; Permission is hereby granted, free of charge, to any person obtaining
                        	    88: ; a copy of this software and associated documentation files
                        	    89: ; (the "Software"), to deal in the Software without restriction, including
                        	    90: ; without limitation the rights to use, copy, modify, merge, publish,
                        	    91: ; distribute, sublicense, and/or sell copies of the Software, and to
                        	    92: ; permit persons to whom the Software is furnished to do so.
                        	    93: ;
                        	    94: ; THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
                        	    95: ; IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
                        	    96: ; FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
                        	    97: ; AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
                        	    98: ; LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
                        	    99: ; FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
                        	   100: ; DEALINGS IN THE SOFTWARE.
                        	   101: 
                        	   102: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   103: ;           Staic RAM Locations                                               ;
                        	   104: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   105: ticks    = $f0              ; 6-bytes
                        	   106: tocks    = $f6              ; 1-byte
                        	   107: cpu_type = $f7              ; 1-byte
                        	   108: 
                        	   109: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   110: ;           W65C22 Versatile Interface Adapter (VIA)                          ;
                        	   111: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   112: PORTB = $6000               ; W65C22 Register "B"
                        	   113: PORTA = $6001               ; W65C22 Register "A"
                        	   114: DDRB  = $6002               ; W65C22 Data Direction Register "B"
                        	   115: DDRA  = $6003               ; W65C22 Data Direction Register "A"
                        	   116: TCL1  = $6004               ; W65C22 T1 Low-Order Counter
                        	   117: TCH1  = $6005               ; W65C22 T1 High-Order Counter
                        	   118: TLL1  = $6006               ; W65C22 T1 Low-Order Latches
                        	   119: TLH1  = $6007               ; W65C22 T1 High-Order Latches
                        	   120: TCL2  = $6008               ; W65C22 T2 Low-Order Counter
                        	   121: TCH2  = $6009               ; W65C22 T2 High-Order Counter
                        	   122: SR    = $600a               ; W65C22 Shift Register
                        	   123: ACR   = $600b               ; W65C22 Auxiliary Control Register
                        	   124: PCR   = $600c               ; W65C22 Peripheral Control Register
                        	   125: IFR   = $600d               ; W65C22 Interrupt Flag Register
                        	   126: IER   = $600e               ; W65C22 Interrupt Enable Register
                        	   127: 
                        	   128: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   129: ;           HD44780U LCD Display Controller                                   ;
                        	   130: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   131: EN = $80                    ; HD44780U LCD Starts data read/write
                        	   132: RW = $40                    ; HD44780U LCD Enables Screen to read data
                        	   133: RS = $20                    ; HD44780U LCD Registers Select
                        	   134: 
                        	   135: 
                        	   136: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   137: ;           Start of program / Reset button pressed                           ;
                        	   138: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   139:                 .org $8000              ; Start at memory location 8000 hex
                        	   140: ;;; Configure the stack
00:8000 A2FF            	   141: boot:           ldx #$ff                ; Set the stack pointer
00:8002 9A              	   142:                 txs
00:8003 78              	   143: reset:          sei                     ; Disable CPU Interrupts
00:8004 D8              	   144:                 cld			            ; clear decimal mode
00:8005 18              	   145:                 clc			            ; clear carry bit
00:8006 A200            	   146:                 ldx #0                  ; Start the Index X at zero
00:8008 A000            	   147:                 ldy #0                  ; Start the Index Y at zero
00:800A A9FF            	   148: Initialize_LCD: lda #$ff          	    ; Set all pins on port "B" to output
00:800C 8D0260          	   149:                 sta DDRB
00:800F A9E1            	   150:                 lda #$e1          	    ; top 3 pins/last, port "A" to output
00:8011 8D0360          	   151:                 sta DDRA
00:8014 A938            	   152:                 lda #$38	            ; 8-bit mode; 2-line display; 5x8 font
00:8016 208F80          	   153:                 jsr lcd_config
00:8019 A90C            	   154:                 lda #$c          	    ; Display on; cursor on; blink off
00:801B 208F80          	   155:                 jsr lcd_config
00:801E A906            	   156:                 lda #$6          	    ; Increment and shift cursor
00:8020 208F80          	   157:                 jsr lcd_config
00:8023 A911            	   158:                 lda #$11          	    ; Clear the LCD display
00:8025 208F80          	   159:                 jsr lcd_config
00:8028 A902            	   160:                 lda #$2          	    ; Send cursor to line 1
00:802A 208F80          	   161:                 jsr lcd_config
00:802D BDDE80          	   162: print_boot:     lda boot_message, x     ; load the first/next character into A
00:8030 F007            	   163:                 beq t1_timer            ; Jump to loop, if accumulator is $00
00:8032 20A580          	   164:                 jsr print_char          ; If not, jump to print_char
00:8035 E8              	   165:                 inx                     ; Increment the Index X
00:8036 4C2D80          	   166:                 jmp print_boot          ; jump back to the top of print_boot
00:8039 A200            	   167: t1_timer:       ldx #0                  ; Zero out the X index
00:803B A900            	   168:                 lda #0                  ; Zero out the accumulator
00:803D 85F0            	   169:                 sta ticks               ; Zero out the ticks memory location
00:803F 85F1            	   170:                 sta ticks + 1           ; Zero out the ticks-1 memory location
00:8041 85F2            	   171:                 sta ticks + 2           ; Zero out the ticks-2 memory location
00:8043 85F3            	   172:                 sta ticks + 3           ; Zero out the ticks-3 memory location
00:8045 85F4            	   173:                 sta ticks + 4           ; Zero out the ticks-4 memory location
00:8047 85F5            	   174:                 sta ticks + 5           ; Zero out the ticks-5 memory location
00:8049 85F6            	   175:                 sta tocks               ; Zero out the tocks memory location
00:804B A940            	   176:                 lda #%01000000     	    ; Set the Timer 1 to Continuous mode
00:804D 8D0B60          	   177:                 sta ACR                 ; Store timer 1 to Aux Control Register
00:8050 A90E            	   178:                 lda #$0e                ; Set timer 1 to trigger every
00:8052 8D0460          	   179:                 sta TCL1                ;   0.25 seconds.
00:8055 A927            	   180:                 lda #$27
00:8057 8D0560          	   181:                 sta TCH1
00:805A A9C0            	   182: enable_irq:     lda #%11000000          ; Enable IRQs & Timer 1 on w65c02
00:805C 8D0E60          	   183:                 sta IER                 ; Store to Interrupt Enable Register
00:805F F8              	   184: cpu_checker:    sed                     ; set decimal mode
00:8060 18              	   185:                 clc                     ; clear carry for add
00:8061 A999            	   186:                 lda #$99                ; actually 99 decimal in this case   
00:8063 6901            	   187:                 adc #$01                ; +1 gives 00 and sets Zb on 65C02
00:8065 D8              	   188:                 cld                     ; exit decimal mode
00:8066 D007            	   189:                 bne mos6502             ; Break (Jump) if MOS 6502 CPU
00:8068 A9C2            	   190:                 lda #$c2                ; WDC 65c02
00:806A 85F7            	   191:                 sta cpu_type
00:806C 207380          	   192:                 jsr ready
00:806F A902            	   193: mos6502:        lda #02                 ; MOS 6502
00:8071 85F7            	   194:                 sta cpu_type
00:8073 A901            	   195: ready:          lda #%00000001          ; Clear the LCD display
00:8075 208F80          	   196:                 jsr lcd_config          ; Jump to the lcd_config subroutine
00:8078 A902            	   197:                 lda #%00000010          ; Send cursor to line 1; home position
00:807A 208F80          	   198:                 jsr lcd_config          ; Jump to the lcd_config subroutine
00:807D A200            	   199:                 ldx #0                  ; Set the X Index to zero
00:807F BDE680          	   200: lcd_ready:      lda ready_message, x    ; load the first/next character into A
00:8082 F007            	   201:                 beq reset_end           ; Jump to loop, if accumulator is $00
00:8084 20A580          	   202:                 jsr print_char          ; If not, jump to print_char
00:8087 E8              	   203:                 inx                     ; Increment the Index X
00:8088 4C7F80          	   204:                 jmp lcd_ready           ; jump back to the top of lcd_ready
00:808B 58              	   205: reset_end:      cli                     ; Enable CPU Interupts
                        	   206: 
                        	   207: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   208: ;           The forever / primary loop                                        ;
                        	   209: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
00:808C 4C8C80          	   210: loop:           jmp loop
                        	   211: 
                        	   212: 
                        	   213: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   214: ;   LCD Subroutines                                                           ;
                        	   215: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   216: 
                        	   217: ;------------------------------------------------------------------------------
                        	   218: ;   LCD Store instruction subroutine
                        	   219: 
00:808F 20BB80          	   220: lcd_config:     jsr lcd_wait            ; Jump to the lcd_wait subroutine
00:8092 8D0060          	   221:                 sta PORTB
00:8095 A900            	   222:                 lda #0                  ; Clear LCD RS/RW/EN bits
00:8097 8D0160          	   223:                 sta PORTA
00:809A A980            	   224:                 lda #EN                 ; Set LCD EN (enable) bit
00:809C 8D0160          	   225:                 sta PORTA
00:809F A900            	   226:                 lda #0                  ; Clear LCD RS/RW/EN bits
00:80A1 8D0160          	   227:                 sta PORTA
00:80A4 60              	   228:                 rts                     ; Return from Subroutine
                        	   229: 
                        	   230: 
                        	   231: ;------------------------------------------------------------------------------
                        	   232: ;   LCD Print Character subroutine
00:80A5 20BB80          	   233: print_char:     jsr lcd_wait            ; Jump to the lcd_wait subroutine
00:80A8 8D0060          	   234:                 sta PORTB
00:80AB A920            	   235:                 lda #RS                 ; Set LCD RS; Clear RW/EN bits
00:80AD 8D0160          	   236:                 sta PORTA
00:80B0 A9A0            	   237:                 lda #(RS | EN)          ; Set LCD EN (enable) bit
00:80B2 8D0160          	   238:                 sta PORTA
00:80B5 A920            	   239:                 lda #RS                 ; Clear LCD EN (enable) bits
00:80B7 8D0160          	   240:                 sta PORTA
00:80BA 60              	   241:                 rts                     ; Return from Subroutine
                        	   242: 
                        	   243: 
                        	   244: ;------------------------------------------------------------------------------
                        	   245: ;   LCD Wait / Busy subroutine
00:80BB 48              	   246: lcd_wait:       pha                     ; Push Accumulator to Stack
00:80BC A900            	   247:                 lda #%00000000          ; Set Port B as an input
00:80BE 8D0260          	   248:                 sta DDRB                ; Load the setting to Port "B"
00:80C1 A940            	   249: lcd_busy:       lda #RW                 ; Set port to Read/Write
00:80C3 8D0160          	   250:                 sta PORTA               ; Load the setting to Port "A"
00:80C6 A9C0            	   251:                 lda #(RW | EN)          ; Set port to Read/Write & Enable
00:80C8 8D0160          	   252:                 sta PORTA               ; Load the setting to Port "A"
00:80CB AD0060          	   253:                 lda PORTB               ; Load Accumulator with Port "B"
00:80CE 2980            	   254:                 and #%10000000          ; Combine the above with $80
00:80D0 D0EF            	   255:                 bne lcd_busy            ; Jump back to the top of lcd_busy
00:80D2 A940            	   256:                 lda #RW                 ; Set port to Read/Write
00:80D4 8D0160          	   257:                 sta PORTA               ; Load the setting to Port "A"
00:80D7 A9FF            	   258:                 lda #%11111111          ; Port B is output
00:80D9 8D0260          	   259:                 sta DDRB                ; Load the setting to Port "B"
00:80DC 68              	   260:                 pla                     ; Pull Accumulator from Stack
00:80DD 60              	   261:                 rts                     ; Return from Subroutine
                        	   262: 
                        	   263: 
                        	   264: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   265: ;           The messages to be be displayed on the LCD screen                 ;
                        	   266: ;                  16x2 Character Limit                                       ;
                        	   267: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   268: ; 16x2 Character Limit  |----------------|
00:80DE 426F6F74696E67  	   269: boot_message:   .asciiz "Booting"
00:80E5 00
00:80E6 5265616479      	   270: ready_message:  .asciiz "Ready"
00:80EB 00
                        	   271: ; 16x2 Character Limit  |----------------|
                        	   272: 
                        	   273: 
                        	   274: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   275: ;           IRQ subroutine                                                    ;
                        	   276: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   277: 
00:80EC 2C0460          	   278: tcl1_runner:    bit TCL1                ; Zero the TCL1 flag
00:80EF E6F0            	   279:                 inc ticks
00:80F1 D014            	   280:                 bne tcl1_runner_2
00:80F3 E6F1            	   281:                 inc ticks + 1
00:80F5 D010            	   282:                 bne tcl1_runner_2
00:80F7 E6F2            	   283:                 inc ticks + 2
00:80F9 D00C            	   284:                 bne tcl1_runner_2  
00:80FB E6F3            	   285:                 inc ticks + 3
00:80FD D008            	   286:                 bne tcl1_runner_2
00:80FF E6F4            	   287:                 inc ticks + 4
00:8101 D004            	   288:                 bne tcl1_runner_2
00:8103 E6F5            	   289:                 inc ticks + 5
00:8105 D000            	   290:                 bne tcl1_runner_2
00:8107 38              	   291: tcl1_runner_2:  sec                     ; Set Carry Flag (enable subtraction)
00:8108 A5F0            	   292:                 lda ticks
00:810A E5F6            	   293:                 sbc tocks
00:810C C919            	   294:                 cmp #25                 ; Have 250ms elapsed?
00:810E 900C            	   295:                 bcc tcl1_end            ; Branch on Carry Clear
00:8110 A901            	   296:                 lda #$01
00:8112 4D0160          	   297:                 eor PORTA               ; xor the value from PORTA to $01
00:8115 8D0160          	   298:                 sta PORTA               ; Toggle the hartbeat LED
00:8118 A5F0            	   299:                 lda ticks
00:811A 85F6            	   300:                 sta tocks               ; Return from Subroutine
00:811C 60              	   301: tcl1_end:       rts
                        	   302: 
00:811D A912            	   303: tcl2_runner:    lda #$12
00:811F 85FF            	   304: 				sta $ff
00:8121 60              	   305: 				rts
                        	   306: 
00:8122 60              	   307: cb1_runner:     rts
                        	   308: 
00:8123 60              	   309: cb2_runner:     rts
                        	   310: 
00:8124 60              	   311: sr_runner:      rts
                        	   312: 
00:8125 A9A1            	   313: ca1_runner:     lda #$a1
00:8127 85FF            	   314: 				sta $ff
00:8129 60              	   315: 				rts
                        	   316: 
00:812A A9A2            	   317: ca2_runner:     lda #$a2
00:812C 85FF            	   318: 				sta $ff
00:812E 60              	   319: 				rts
                        	   320: 
00:812F 78              	   321: irq:            sei
00:8130 48              	   322:                 pha                     ; Save accumulator
00:8131 8A              	   323:                 txa
00:8132 48              	   324:                 pha                     ; Save X-register
00:8133 98              	   325:                 tya
00:8134 48              	   326:                 pha                     ; Save Y-register
00:8135 D8              	   327:                 cld                     ; Enable binary mode/clear decimal flag
00:8136 AD0D60          	   328:                 lda IFR
                        	   329:                 ;bpl irq_end             ; Exit if the VIA didn't create the IRQ
00:8139 0A              	   330:                 asl 
00:813A 30B0            	   331:                 bmi tcl1_runner         ; Timer CA 1 
00:813C 0A              	   332:                 asl 
00:813D 30DE            	   333:                 bmi tcl2_runner         ; Timer CA 2
00:813F 0A              	   334:                 asl 
00:8140 30E0            	   335:                 bmi cb1_runner          ; Peripheral B Control Line 1
00:8142 0A              	   336:                 asl 
00:8143 30DE            	   337:                 bmi cb2_runner          ; Peripheral B Control Line 2
00:8145 0A              	   338:                 asl 
00:8146 30DC            	   339:                 bmi sr_runner           ; Shift Register
00:8148 0A              	   340:                 asl 
00:8149 30DA            	   341:                 bmi ca1_runner          ; Peripheral A Control Line 1
00:814B 0A              	   342:                 asl 
00:814C 30DC            	   343:                 bmi ca2_runner          ; Peripheral A Control Line 2
00:814E 68              	   344: irq_end:        pla
00:814F A8              	   345:                 tay                     ; restore Y-register
00:8150 68              	   346:                 pla
00:8151 AA              	   347:                 tax                     ; restore X-register
00:8152 68              	   348:                 pla                     ; restore accumulator
00:8153 58              	   349:                 cli
00:8154 40              	   350:                 rti                     ; resume interrupted task
                        	   351: 
                        	   352: 
                        	   353: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   354: ;           W65C02 Memory starting block stored at end of ROM                 ;
                        	   355: ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                        	   356:                 .org $fffc
01:FFFC 0080            	   357:                 .word boot
01:FFFE 2F81            	   358:                 .word irq


Symbols by name:
ACR                              E:600B
DDRA                             E:6003
DDRB                             E:6002
EN                               E:0080
IER                              E:600E
IFR                              E:600D
Initialize_LCD                   A:800A
PORTA                            E:6001
PORTB                            E:6000
RS                               E:0020
RW                               E:0040
TCH1                             E:6005
TCL1                             E:6004
boot                             A:8000
boot_message                     A:80DE
ca1_runner                       A:8125
ca2_runner                       A:812A
cb1_runner                       A:8122
cb2_runner                       A:8123
cpu_checker                      A:805F
cpu_type                         E:00F7
enable_irq                       A:805A
irq                              A:812F
irq_end                          A:814E
lcd_busy                         A:80C1
lcd_config                       A:808F
lcd_ready                        A:807F
lcd_wait                         A:80BB
loop                             A:808C
mos6502                          A:806F
print_boot                       A:802D
print_char                       A:80A5
ready                            A:8073
ready_message                    A:80E6
reset                            A:8003
reset_end                        A:808B
sr_runner                        A:8124
t1_timer                         A:8039
tcl1_end                         A:811C
tcl1_runner                      A:80EC
tcl1_runner_2                    A:8107
tcl2_runner                      A:811D
ticks                            E:00F0
tocks                            E:00F6

Symbols by value:
0020 RS
0040 RW
0080 EN
00F0 ticks
00F6 tocks
00F7 cpu_type
6000 PORTB
6001 PORTA
6002 DDRB
6003 DDRA
6004 TCL1
6005 TCH1
600B ACR
600D IFR
600E IER
8000 boot
8003 reset
800A Initialize_LCD
802D print_boot
8039 t1_timer
805A enable_irq
805F cpu_checker
806F mos6502
8073 ready
807F lcd_ready
808B reset_end
808C loop
808F lcd_config
80A5 print_char
80BB lcd_wait
80C1 lcd_busy
80DE boot_message
80E6 ready_message
80EC tcl1_runner
8107 tcl1_runner_2
811C tcl1_end
811D tcl2_runner
8122 cb1_runner
8123 cb2_runner
8124 sr_runner
8125 ca1_runner
812A ca2_runner
812F irq
814E irq_end
